#### 一、需要达成的目标

1、在仿真环境中运行vins-fusion

2、在仿真环境中建立地图

3、实际测试

#### 二、需要完成的各个小任务

#### 1、学会AirSim仿真环境搭建

1、建立地图

点击新建Game，根据需求选择设置，选择模板，即可创建工程

2、导入无人机、无人车插件

（1）复制Plugin

（2）复制Blocks下面的Genfile.sh并运行

（3）打开工程，删除地图中原来的飞机或车或人

（4）选择Mode为AirsimMode

（5）点击运行即可加载小车插件

3、得到传感器数据

https://microsoft.github.io/AirSim/airsim_ros_pkgs/

1、双目图像，频率需要达到30HZ

2、IMU数据，频率需要达到100HZ



注意：UE4需要作为当前活跃窗口，否则会掉帧特别严重。



在Airsim中跑通VinsFusion

https://github.com/microsoft/AirSim/issues/2369

问题总结：

1、角速度有误，airsim中已经是角速度

2、坐标系统混乱

3、不必要的线程锁降低了系统性能，slam系统需要高频率的IMU和低频率的image，没有锁的话IMU甚至能达到300HZ。

4、ros package使用的是单个请求获得图像，如果使用双目的话就会变慢，如果simGetImages使用多个请求会变得更快。

5、ros package使用软时间戳代替仿真时间。

6、没有地方设置系统IP



##### 2、部署Vins-Fusion算法

1、更改话题名，将AirSim中的数据转换为Vins-Fusion需要的数据



##### 3、建立地图

1、学习Octomap的使用，将点云数据转化为八叉树地图

2、



#### Promethus环境安装

1、报python错的时候需要换阿里源

2、报权限错误的时候需要给权限

chmod -R 777  filename

3、需要有个好用的梯子



#### Conda常用指令

conda  create  - - name test python=3.9

conda activate test

conda deactivate

conda env list

conda env remove -name test 

conda list



#### 三、由于Airsim中的数据问题，现在改用Gazebo

Vins部署需求：

1、双目图像数据               **完成**

30FPS

2、IMU数据                  **完成**

频率100HZ

参考：https://github.com/cyanine-gi/VINS_Fusion-simulation

![image-20220424171812768](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220424171812768.png)

修改P450的IMU参数，得到IMU数据

3、左右目相机参数                 **完成**

由于没有畸变，该文件已有        

4、相机外参                      **完成**

根据建模可以直接得到

5、IMU参数                      **完成**

随机游走

高斯噪声

#### 四、将Vins-fusion用于无人机的位置估计
1、修改无人机位姿估计数据源
2、发布SLAM估计的无人机位姿

#### 五、在仿真环境中测试算法性能
1、保存SLAM位姿为tum格式
2、保存真值位姿为tum格式
3、使用evo工具对性能进行评估

#### 六、建图
1、使用局部点云进行点云拼接得到全局点云
2、使用全局点云建立栅格地图
3、使用栅格地图建立ESDF
4、对历史ESDF进行保存

##### 建图部分今日的调研结果：
1、ESDF地图全称为欧式符号距离函数，存放的内容为到障碍物的距离信息，可以计算梯度用于路径规划。
2、TSDF为截断符号距离函数，存放的内容为截断（摄像头视角内）的到最近障碍物的距离信息。
3、ESDF有增量式更新的全局ESDF（在地面站建立），和局部的ESDF（在机载电脑建立），局部的ESDF会设定一个矩形区域，对
矩形区域以外的地图进行遗忘。
4、相关的参考内容：
（1）增量更新的全局ESDF：HKUST的FIESTA https://github.com/HKUST-Aerial-Robotics/FIESTA 这个可以在地面站试着建立
（2）局部的ESDF：HKUST的 Teach-repeat-replan 的local map部分 https://github.com/HKUST-Aerial-Robotics/Teach-Repeat-Replan
（3）ego-planner的建图部分 参考论文为：H. Moravec, A. Elfes, High resolution maps from wide angle sonar, IEEE International
Conference on Robotics and Automation (IEEE, 1985), vol. 2, pp. 116–121.
（4）elastic tracker的建图部分
